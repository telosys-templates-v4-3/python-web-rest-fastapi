#set( $env.language = 'Python' )
#parse("_include/standard-python-header.vm")
# Database operations decorators

import logging
from functools import wraps

logger = logging.getLogger(__name__)

def db_write_operation(func):
    """Decorator for write DB operations. Logs exception and rollback."""
    @wraps(func)
    def wrapper(self, *args, **kwargs):
        try:
            return func(self, *args, **kwargs)
        except Exception: # Any exception including SQLAlchemyError
            self.db.rollback() 
            logger.exception(
                "Error in write operation %s: args=%s, kwargs=%s",
                func.__name__, args, kwargs
            )
            raise
    return wrapper

def db_read_operation(func):
    """Decorator for read-only DB operations. Logs exception but no rollback."""
    @wraps(func)
    def wrapper(self, *args, **kwargs):
        try:
            return func(self, *args, **kwargs)
        except Exception: # Any exception including SQLAlchemyError
            logger.exception(
                "Error in read-only operation %s: args=%s, kwargs=%s",
                func.__name__, args, kwargs
            )
            raise
    return wrapper